## 栈

​	栈是一种“先进后出”的线性数据结构。栈只有一端能够进出元素。能进出元素的一端叫栈顶，不能进出元素的一端叫栈底。当我们添加或者删除元素的时候，只能从栈顶操作。

![image-20201205151854875](https://i.loli.net/2020/12/05/TIgM1ozwketxyUA.png)

上图就是一个栈，栈里面有三个元素。其中 3 号元素是栈顶，1 号元素栈底。只有当前元素是栈顶的时候才能出栈。所以上图只有 3 号元素可以出栈。如果 3 号元素出栈，那么栈顶就会变成 2 号元素。



#### 例题

​	实现一个栈，支持 Push（入栈）、Pop（出栈）和 GetMax （查询栈内元素的最大值）三个操作，要求时间复杂度均为 O(1).

**思路：**

​	要求时间复杂度为O(1), 所以每 Push 一个元素的时候就要立刻知道最大值，所以我们可以定义一个变量 y 来表示当前栈里面元素的最大值，如果有元素进来，就可以和 y 比较一下，取最大就可以了。

​	![image-20201205154625263](https://i.loli.net/2020/12/05/7Jq3yEevkdlOrUV.png)

​	具体来说，就是维护两个栈，栈 A 存储原本的数据，栈 B 存储栈 A 中以栈底开头的每段数据的最大值。如上图所示：

​	当执行 Push(y) 的时候，在 A 中插入 y，在 B 中插入 max(y, B的栈顶数据)。在执行Pop操作时，在 A、B 两个栈中分别出栈。在执行 GetMax 操作时，取出 B栈的栈顶元素就可以了。



### 单调栈

单调栈内的元素是递增或者递减的。

单调栈的作用：

- 求左面第一个大于或者小于当前元素的位置
- 求右面第一个大于或者小于当前元素的位置

#### 例题：

​	一个数组 arr， 有 n 个数字， 对于每个位置的数字，求左边第一个小于当前数字的位置。

**示例：**

```c++
输入： arr = [2, 4, 6, 5, 3, 1, 8]
输出： [-1, 0, 1, 1, 0, -1, 5]
```

​	如果是暴力， 那就对每一个位置 i， 然后向前找，遇到大于等于当前数的接着找，直到找到一个小于的位置 j。这样的时间复杂度是 $O(n^2)$ 的。在暴力的基础上要优化一下。

​	对于 i， i-1 这两个位置。i 可以复用 i - 1 的情况。如果 arr[i] > arr[i-1]， 那么 i 这个位置的答案就是 i - 1, 否则 i 就要向前找，这个时候 i 就可以复用 i - 1 的情况了， 因为 i - 1 跳过的值就是 >= arr[i-1] 的， arr[i-1] >= a[i]，所以 跳过的值必然也是 >= arr[i] 的， 所以这些值也就可以直接跳过。

​	知道了上面的流程，就可以来了解怎么使用单调栈了。 

​	栈里面维护的是每个值的位置。当加入一个新值的时候，用新值不断的和栈顶进行比较，如果新值大于栈顶，那么栈顶就是我们要找的位置， 否则就是新值小于等于栈顶所代表的数字，那么栈顶就要出栈。新值接着和栈顶进行下一次的比较。直到新值大于栈顶或者栈里面没有数字了。

​	上面的步骤结束之后，记录答案，然后让新值的位置进栈，

总结一下就是： 每个值进栈的时候，都会弹掉前面那些大于等于自己的数字。

由于每个值最多进栈一次，出栈一次，所以时间复杂度是 $O(n)$ 

 ```c++
stack<int>stk;
int sz = arr.size();
for (int i = 0; i < sz; ++i){
    while(stk.size() && arr[i] <= arr[stk.top()]) stk.pop(); // 如果当前的值 小于等于栈顶所代表的值， 就不断的弹栈，直到遇见大于当前的值
    L[i] = stk.size() ? stk.top() : -1;   // L 记录的是答案， 如果栈里面有值，记录的是栈顶的值，否之是 -1. 
    stk.push(i);  // 把当前位置压栈。
}
 ```







### 训练题目：

- [ ] [剑指 Offer 59 - II. 队列的最大值](https://leetcode-cn.com/problems/dui-lie-de-zui-da-zhi-lcof/)
- [ ] [剑指 Offer 09. 用两个栈实现队列](https://leetcode-cn.com/problems/yong-liang-ge-zhan-shi-xian-dui-lie-lcof/)
- [ ] [剑指 Offer 30. 包含min函数的栈](https://leetcode-cn.com/problems/bao-han-minhan-shu-de-zhan-lcof/)